<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DSA College Problem Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js"></script>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
        }
    </script>
    <style>
        /* Floating particles animation */
        .floating-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }
        
        .particle {
            position: absolute;
            background: linear-gradient(45deg, #4b5563, #6b7280, #9ca3af);
            border-radius: 50%;
            animation: float 15s infinite linear;
            opacity: 0.1;
        }
        
        .particle:nth-child(odd) {
            animation-duration: 20s;
            background: linear-gradient(45deg, #6b7280, #9ca3af, #4b5563);
        }
        
        .particle:nth-child(3n) {
            animation-duration: 25s;
            background: linear-gradient(45deg, #9ca3af, #d1d5db, #6b7280);
        }
        
        @keyframes float {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 0.1;
            }
            90% {
                opacity: 0.1;
            }
            100% {
                transform: translateY(-100vh) rotate(360deg);
                opacity: 0;
            }
        }
        
        /* Glassmorphism effect */
        .glass {
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* Card hover animations - simplified */
        .card-hover {
            transition: all 0.2s ease;
        }
        
        /* Pulse animation for completed items - reduced */
        @keyframes pulse-success {
            0% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.5); }
            70% { box-shadow: 0 0 0 6px rgba(34, 197, 94, 0); }
            100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); }
        }
        
        .pulse-success {
            animation: pulse-success 1.5s ease-out;
        }
        
        /* Slide in animations */
        @keyframes slideInUp {
            from {
                transform: translateY(30px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .animate-slideInUp {
            animation: slideInUp 0.6s ease-out;
        }
        
        /* Gradient text animation */
        @keyframes gradient-shift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .gradient-animate {
            background: linear-gradient(-45deg, #3b82f6, #8b5cf6, #ec4899, #06b6d4);
            background-size: 400% 400%;
            animation: gradient-shift 3s ease infinite;
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-900 via-gray-800 to-black dark:from-gray-900 dark:via-gray-800 dark:to-black light:from-gray-50 light:via-blue-50 light:to-purple-50 min-h-screen transition-all duration-500 relative overflow-x-hidden">
    <!-- Floating Particles -->
    <div class="floating-particles" id="particles"></div>
    
    <!-- Authentication Check -->
    <script>
        // Check authentication first
        const currentUser = localStorage.getItem('currentUser');
        const isAdmin = localStorage.getItem('isAdmin');
        
        if (!currentUser && !isAdmin) {
            window.location.href = 'auth.html';
        }
    </script>

    <div class="container mx-auto px-4 py-8 relative z-10">
        <!-- Header -->
        <div class="mb-8 animate-slideInUp">
            <div class="flex justify-between items-center mb-4">
                <div>
                    <h1 class="text-4xl font-bold gradient-animate mb-3">
                        DSA College Problems Sheet.
                    </h1>
                    <p class="text-gray-400 dark:text-gray-400 light:text-black text-base">Master essential college-level problems with structured practice — <a href="https://www.linkedin.com/in/ashish2208/" class="bg-gradient-to-r from-yellow-400 to-orange-500 hover:from-yellow-500 hover:to-orange-600 text-white font-semibold px-3 py-1 rounded-full shadow-lg transition-all duration-300 hover:scale-105">Ashish Sharma</a></p>
                </div>
                <!-- Navigation and Dark Mode Toggle -->
                <div class="flex items-center space-x-4">
                    <a href="index.html" class="px-5 py-2 bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white rounded-xl transition-all duration-300 flex items-center shadow-lg text-sm">
                        <i class="fas fa-arrow-left mr-2"></i>
                        Back to Hub
                    </a>
                    <button 
                        id="darkModeToggle"
                        class="p-3 rounded-full bg-white/10 dark:bg-gray-800/50 light:bg-white backdrop-blur-lg shadow-xl transition-all duration-300 border border-white/20 dark:border-gray-700 light:border-gray-200"
                    >
                        <i class="fas fa-moon text-white dark:text-yellow-400 light:text-gray-600 text-lg" id="darkModeIcon"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Search and Stats -->
        <div class="glass bg-white/10 dark:bg-gray-800/30 light:bg-white/80 backdrop-blur-xl rounded-3xl shadow-2xl border border-white/20 dark:border-gray-700/50 light:border-gray-200 p-6 mb-8 animate-slideInUp">
            <div class="flex flex-col md:flex-row gap-6 items-center justify-between">
                <div class="relative flex-1 max-w-md">
                    <input 
                        type="text" 
                        id="searchInput" 
                        placeholder="Search College problems..." 
                        class="w-full pl-12 pr-4 py-3 bg-white/20 dark:bg-gray-700/50 light:bg-gray-50 border border-white/30 dark:border-gray-600/50 light:border-gray-300 rounded-2xl focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-transparent text-gray-200 dark:text-gray-200 light:text-gray-900 placeholder-gray-400 dark:placeholder-gray-400 light:placeholder-gray-500 transition-all duration-300 backdrop-blur-lg text-sm"
                    >
                    <i class="fas fa-search absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400 dark:text-gray-400 light:text-black"></i>
                </div>
                <div class="flex gap-3 text-xs">
                    <div class="px-4 py-2 bg-gradient-to-r from-emerald-500 to-teal-600 text-white rounded-xl shadow-xl transition-all duration-300">
                        <i class="fas fa-check mr-1"></i>
                        Completed: <span id="completedCount" class="font-bold">0</span>
                    </div>
                    <div class="px-4 py-2 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-xl shadow-xl transition-all duration-300">
                        <i class="fas fa-graduation-cap mr-1"></i>
                        Total: <span id="totalCount" class="font-bold">0</span>
                    </div>
                    <div class="px-4 py-2 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-xl shadow-xl transition-all duration-300">
                        <i class="fas fa-percentage mr-1"></i>
                        <span id="progressPercentage" class="font-bold">0%</span>
                    </div>
                </div>
            </div>
            <!-- Progress Bar -->
            <div class="mt-5">
                <div class="flex justify-between text-xs text-gray-400 dark:text-gray-400 light:text-black mb-2">
                    <span class="font-medium">College DSA Mastery Progress</span>
                    <span id="progressText" class="font-bold">0 / 0</span>
                </div>
                <div class="w-full bg-white/20 dark:bg-gray-700/50 light:bg-gray-200 rounded-full h-3 overflow-hidden">
                    <div 
                        id="progressBar" 
                        class="bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 h-3 rounded-full transition-all duration-1000 ease-out shadow-lg"
                        style="width: 0%"
                    ></div>
                </div>
            </div>
        </div>

        <!-- Problem Sections -->
        <div id="problemSections" class="space-y-6">
            <!-- Sections will be populated here -->
        </div>
    </div>

    <!-- Footer -->
    <footer class="glass bg-gradient-to-r from-black/95 via-gray-950/95 to-black/95 dark:from-black/98 dark:via-gray-950/98 dark:to-black/98 light:from-white/90 light:via-gray-50/90 light:to-white/90 backdrop-blur-2xl border-t border-white/5 dark:border-white/5 light:border-gray-200/50 text-white dark:text-white light:text-black mt-20 relative overflow-hidden">
        <div class="absolute inset-0 bg-gradient-to-br from-gray-950/30 via-black/40 to-gray-950/30 dark:from-gray-950/40 dark:via-black/50 dark:to-gray-950/40 light:from-blue-100/20 light:via-purple-100/20 light:to-pink-100/20"></div>
        
        <div class="container mx-auto px-4 py-16 relative z-10">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-12">
                <div class="space-y-6">
                    <h3 class="text-2xl font-bold bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 bg-clip-text text-transparent">
                        College DSA Problems
                    </h3>
                    <p class="text-gray-300 leading-relaxed text-sm">
                        Essential college-level Data Structures & Algorithms problems covering all major topics for coding interviews and competitive programming.
                    </p>
                </div>
                <div class="space-y-6">
                    <h4 class="text-xl font-bold bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent">Quick Links</h4>
                    <ul class="space-y-3">
                        <li><a href="index.html" class="flex items-center p-2 glass bg-black/20 dark:bg-black/30 hover:bg-black/30 dark:hover:bg-black/40 rounded-lg transition-all duration-300 hover:scale-105 backdrop-blur-sm text-sm group">
                            <i class="fas fa-home mr-3 text-blue-400 group-hover:scale-110 transition-transform duration-300"></i>
                            <span class="text-gray-300 group-hover:text-blue-400">Back to Hub</span>
                        </a></li>
                    </ul>
                </div>
                <div class="space-y-6">
                    <h4 class="text-xl font-bold bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent">Features</h4>
                    <ul class="space-y-2 text-sm text-gray-300">
                        <li class="flex items-center"><i class="fas fa-check mr-2 text-green-400"></i>53 Essential Problems</li>
                        <li class="flex items-center"><i class="fas fa-check mr-2 text-green-400"></i>8 Core Topics</li>
                        <li class="flex items-center"><i class="fas fa-check mr-2 text-green-400"></i>Progress Tracking</li>
                        <li class="flex items-center"><i class="fas fa-check mr-2 text-green-400"></i>Interview Prep</li>
                    </ul>
                </div>
            </div>
            
            <div class="border-t border-white/10 mt-12 pt-8 text-center">
                <p class="text-gray-400 text-sm">
                    © 2024 Programming Series Hub. Created by <span class="font-bold bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent">Ashish Sharma</span>
                </p>
            </div>
        </div>
    </footer>

    <script>
        // Firebase Configuration - YOUR ACTUAL CONFIG
        const firebaseConfig = {
            apiKey: "AIzaSyBbOMWi1qdWOzpm_0KeLE_mOHUGjzk0He4",
            authDomain: "programming-series-hub.firebaseapp.com",
            projectId: "programming-series-hub",
            storageBucket: "programming-series-hub.firebasestorage.app",
            messagingSenderId: "919993604014",
            appId: "1:919993604014:web:bd0f8f34a5e923ecf31a3f",
            measurementId: "G-ZJY6P2HHR7"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Auto-logout if user is deleted from Firebase
        async function verifyUserExists() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            const isAdmin = localStorage.getItem('isAdmin');
            
            // Skip verification for admin users
            if (isAdmin === 'true') {
                return true;
            }
            
            if (!currentUser || !currentUser.id) {
                return true; // Let normal auth flow handle this
            }
            
            try {
                // Check if user still exists in Firebase using their ID (not email)
                const userDoc = await db.collection('users').doc(currentUser.id.toString()).get();
                
                if (!userDoc.exists) {
                    // User has been deleted from Firebase, logout immediately
                    console.log('User deleted by admin, logging out...');
                    localStorage.removeItem('currentUser');
                    localStorage.removeItem('userProgress');
                    localStorage.removeItem('collegeProblemStatus');
                    localStorage.removeItem('collegeDarkMode');
                    
                    // Show notification and redirect
                    alert('Your account has been removed by the administrator. You will be redirected to the login page.');
                    window.location.href = 'auth.html';
                    return false;
                }
                
                return true;
            } catch (error) {
                console.error('Error verifying user:', error);
                // On error, allow user to continue (Firebase might be temporarily unavailable)
                return true;
            }
        }

        // Run verification on page load and periodically
        verifyUserExists();
        
        // Check every 30 seconds if user still exists
        setInterval(verifyUserExists, 30000);

        // Firebase-only, no localStorage - Cross-browser sync
        let problemStatus = {};
        let allProblems = [];

        // Load problem status from Firebase on page load
        async function loadProblemStatusFromFirebase() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            if (!currentUser) return;
            
            try {
                const doc = await db.collection('userProblemStatus').doc(`${currentUser.email}_Collage`).get();
                if (doc.exists) {
                    problemStatus = doc.data().status || {};
                    console.log('Collage problem status loaded from Firebase');
                } else {
                    problemStatus = {};
                    console.log('No existing Collage problem status found, starting fresh');
                }
            } catch (error) {
                console.error('Error loading Collage problem status from Firebase:', error);
                problemStatus = {};
            }
        }

        // College DSA Problem data structure - 53 problems across 8 topics
        const problemData = {
            "Arrays & Mathematics": [
                { name: "Kadane's Algorithm", difficulty: "Medium", leetcode: "https://leetcode.com/problems/maximum-subarray/", gfg: "https://www.geeksforgeeks.org/largest-sum-contiguous-subarray/" },
                { name: "Merge Intervals", difficulty: "Medium", leetcode: "https://leetcode.com/problems/merge-intervals/", gfg: "https://www.geeksforgeeks.org/merging-intervals/" },
                { name: "Best Time to Buy & Sell Stock", difficulty: "Easy", leetcode: "https://leetcode.com/problems/best-time-to-buy-and-sell-stock/", gfg: "https://www.geeksforgeeks.org/best-time-to-buy-and-sell-stock/" },
                { name: "Two Sum", difficulty: "Easy", leetcode: "https://leetcode.com/problems/two-sum/", gfg: "https://www.geeksforgeeks.org/given-an-array-a-and-a-number-x-check-for-pair-in-a-with-sum-as-x/" },
                { name: "Rotate Matrix", difficulty: "Medium", leetcode: "https://leetcode.com/problems/rotate-image/", gfg: "https://www.geeksforgeeks.org/rotate-a-matrix-by-90-degree-in-clockwise-direction-without-using-any-extra-space/" },
                { name: "Next Permutation", difficulty: "Medium", leetcode: "https://leetcode.com/problems/next-permutation/", gfg: "https://www.geeksforgeeks.org/next-permutation/" },
                { name: "Set Matrix Zero", difficulty: "Medium", leetcode: "https://leetcode.com/problems/set-matrix-zeroes/", gfg: "https://www.geeksforgeeks.org/a-boolean-matrix-question/" },
                { name: "Pascal's Triangle", difficulty: "Easy", leetcode: "https://leetcode.com/problems/pascals-triangle/", gfg: "https://www.geeksforgeeks.org/pascal-triangle/" },
                { name: "Merge Sorted Arrays", difficulty: "Easy", leetcode: "https://leetcode.com/problems/merge-sorted-array/", gfg: "https://www.geeksforgeeks.org/merge-two-sorted-arrays/" }
            ],
            "Binary Search": [
                { name: "Binary Search", difficulty: "Easy", leetcode: "https://leetcode.com/problems/binary-search/", gfg: "https://www.geeksforgeeks.org/binary-search/" },
                { name: "Search in Rotated Sorted Array", difficulty: "Medium", leetcode: "https://leetcode.com/problems/search-in-rotated-sorted-array/", gfg: "https://www.geeksforgeeks.org/search-an-element-in-a-sorted-and-pivoted-array/" },
                { name: "Count Inversions", difficulty: "Hard", leetcode: "", gfg: "https://www.geeksforgeeks.org/counting-inversions/" },
                { name: "Aggressive Cows", difficulty: "Hard", leetcode: "", gfg: "https://www.geeksforgeeks.org/aggressive-cows-problem/" },
                { name: "Koko Eating Bananas", difficulty: "Medium", leetcode: "https://leetcode.com/problems/koko-eating-bananas/", gfg: "https://www.geeksforgeeks.org/koko-eating-bananas/" },
                { name: "Median of Two Sorted Arrays", difficulty: "Hard", leetcode: "https://leetcode.com/problems/median-of-two-sorted-arrays/", gfg: "https://www.geeksforgeeks.org/median-of-two-sorted-arrays/" },
                { name: "Find Peak Element", difficulty: "Medium", leetcode: "https://leetcode.com/problems/find-peak-element/", gfg: "https://www.geeksforgeeks.org/find-a-peak-in-a-given-array/" }
            ],
            "Hashing & Strings": [
                { name: "Longest Consecutive Sequence", difficulty: "Medium", leetcode: "https://leetcode.com/problems/longest-consecutive-sequence/", gfg: "https://www.geeksforgeeks.org/longest-consecutive-subsequence/" },
                { name: "4 Sum Problem", difficulty: "Medium", leetcode: "https://leetcode.com/problems/4sum/", gfg: "https://www.geeksforgeeks.org/find-four-numbers-with-sum-equal-to-given-sum/" },
                { name: "Group Anagrams", difficulty: "Medium", leetcode: "https://leetcode.com/problems/group-anagrams/", gfg: "https://www.geeksforgeeks.org/given-a-sequence-of-words-print-all-anagrams-together/" },
                { name: "Count Subarrays with Given Sum", difficulty: "Medium", leetcode: "https://leetcode.com/problems/subarray-sum-equals-k/", gfg: "https://www.geeksforgeeks.org/number-subarrays-sum-exactly-equal-k/" },
                { name: "Longest Substring Without Repeating Characters", difficulty: "Medium", leetcode: "https://leetcode.com/problems/longest-substring-without-repeating-characters/", gfg: "https://www.geeksforgeeks.org/length-of-the-longest-substring-without-repeating-characters/" }
            ],
            "Linked Lists": [
                { name: "Reverse a Linked List", difficulty: "Easy", leetcode: "https://leetcode.com/problems/reverse-linked-list/", gfg: "https://www.geeksforgeeks.org/reverse-a-linked-list/" },
                { name: "Detect Cycle in Linked List", difficulty: "Easy", leetcode: "https://leetcode.com/problems/linked-list-cycle/", gfg: "https://www.geeksforgeeks.org/detect-loop-in-a-linked-list/" },
                { name: "Merge Two Sorted Lists", difficulty: "Easy", leetcode: "https://leetcode.com/problems/merge-two-sorted-lists/", gfg: "https://www.geeksforgeeks.org/merge-two-sorted-linked-lists/" },
                { name: "Find Intersection Point", difficulty: "Easy", leetcode: "https://leetcode.com/problems/intersection-of-two-linked-lists/", gfg: "https://www.geeksforgeeks.org/write-a-function-to-get-the-intersection-point-of-two-linked-lists/" },
                { name: "Flatten Linked List", difficulty: "Hard", leetcode: "", gfg: "https://www.geeksforgeeks.org/flattening-a-linked-list/" },
                { name: "LRU Cache Design", difficulty: "Medium", leetcode: "https://leetcode.com/problems/lru-cache/", gfg: "https://www.geeksforgeeks.org/lru-cache-implementation/" }
            ],
            "Binary Trees": [
                { name: "Inorder Traversal", difficulty: "Easy", leetcode: "https://leetcode.com/problems/binary-tree-inorder-traversal/", gfg: "https://www.geeksforgeeks.org/tree-traversals-inorder-preorder-and-postorder/" },
                { name: "Preorder Traversal", difficulty: "Easy", leetcode: "https://leetcode.com/problems/binary-tree-preorder-traversal/", gfg: "https://www.geeksforgeeks.org/tree-traversals-inorder-preorder-and-postorder/" },
                { name: "Postorder Traversal", difficulty: "Easy", leetcode: "https://leetcode.com/problems/binary-tree-postorder-traversal/", gfg: "https://www.geeksforgeeks.org/tree-traversals-inorder-preorder-and-postorder/" },
                { name: "Level Order Traversal", difficulty: "Medium", leetcode: "https://leetcode.com/problems/binary-tree-level-order-traversal/", gfg: "https://www.geeksforgeeks.org/level-order-tree-traversal/" },
                { name: "Diameter of Binary Tree", difficulty: "Easy", leetcode: "https://leetcode.com/problems/diameter-of-binary-tree/", gfg: "https://www.geeksforgeeks.org/diameter-of-a-binary-tree/" },
                { name: "Symmetric Tree", difficulty: "Easy", leetcode: "https://leetcode.com/problems/symmetric-tree/", gfg: "https://www.geeksforgeeks.org/symmetric-tree-tree-which-is-mirror-image-of-itself/" },
                { name: "Lowest Common Ancestor", difficulty: "Medium", leetcode: "https://leetcode.com/problems/lowest-common-ancestor-of-a-binary-tree/", gfg: "https://www.geeksforgeeks.org/lowest-common-ancestor-binary-tree-set-1/" },
                { name: "Serialize and Deserialize Binary Tree", difficulty: "Hard", leetcode: "https://leetcode.com/problems/serialize-and-deserialize-binary-tree/", gfg: "https://www.geeksforgeeks.org/serialize-deserialize-binary-tree/" }
            ],
            "Binary Search Trees": [
                { name: "Validate BST", difficulty: "Medium", leetcode: "https://leetcode.com/problems/validate-binary-search-tree/", gfg: "https://www.geeksforgeeks.org/a-program-to-check-if-a-binary-tree-is-bst-or-not/" },
                { name: "Kth Smallest Element in BST", difficulty: "Medium", leetcode: "https://leetcode.com/problems/kth-smallest-element-in-a-bst/", gfg: "https://www.geeksforgeeks.org/find-k-th-smallest-element-in-bst-order-statistics-in-bst/" },
                { name: "LCA in BST", difficulty: "Easy", leetcode: "https://leetcode.com/problems/lowest-common-ancestor-of-a-binary-search-tree/", gfg: "https://www.geeksforgeeks.org/lowest-common-ancestor-in-a-binary-search-tree/" },
                { name: "Convert Sorted Array to BST", difficulty: "Easy", leetcode: "https://leetcode.com/problems/convert-sorted-array-to-binary-search-tree/", gfg: "https://www.geeksforgeeks.org/sorted-array-to-balanced-bst/" }
            ],
            "Dynamic Programming": [
                { name: "0/1 Knapsack", difficulty: "Medium", leetcode: "", gfg: "https://www.geeksforgeeks.org/0-1-knapsack-problem-dp-10/" },
                { name: "Longest Common Subsequence", difficulty: "Medium", leetcode: "https://leetcode.com/problems/longest-common-subsequence/", gfg: "https://www.geeksforgeeks.org/longest-common-subsequence-dp-4/" },
                { name: "Longest Increasing Subsequence", difficulty: "Medium", leetcode: "https://leetcode.com/problems/longest-increasing-subsequence/", gfg: "https://www.geeksforgeeks.org/longest-increasing-subsequence-dp-3/" },
                { name: "Matrix Chain Multiplication", difficulty: "Hard", leetcode: "", gfg: "https://www.geeksforgeeks.org/matrix-chain-multiplication-dp-8/" },
                { name: "Coin Change", difficulty: "Medium", leetcode: "https://leetcode.com/problems/coin-change/", gfg: "https://www.geeksforgeeks.org/coin-change-dp-7/" },
                { name: "Edit Distance", difficulty: "Hard", leetcode: "https://leetcode.com/problems/edit-distance/", gfg: "https://www.geeksforgeeks.org/edit-distance-dp-5/" }
            ],
            "Graphs": [
                { name: "BFS", difficulty: "Medium", leetcode: "", gfg: "https://www.geeksforgeeks.org/breadth-first-search-or-bfs-for-a-graph/" },
                { name: "DFS", difficulty: "Medium", leetcode: "", gfg: "https://www.geeksforgeeks.org/depth-first-search-or-dfs-for-a-graph/" },
                { name: "Detect Cycle in Undirected Graph", difficulty: "Medium", leetcode: "", gfg: "https://www.geeksforgeeks.org/detect-cycle-undirected-graph/" },
                { name: "Topological Sort", difficulty: "Medium", leetcode: "https://leetcode.com/problems/course-schedule-ii/", gfg: "https://www.geeksforgeeks.org/topological-sorting/" },
                { name: "Dijkstra's Algorithm", difficulty: "Medium", leetcode: "", gfg: "https://www.geeksforgeeks.org/dijkstras-shortest-path-algorithm-greedy-algo-7/" },
                { name: "Minimum Spanning Tree - Kruskal", difficulty: "Hard", leetcode: "", gfg: "https://www.geeksforgeeks.org/kruskals-minimum-spanning-tree-algorithm-greedy-algo-2/" },
                { name: "Word Ladder", difficulty: "Hard", leetcode: "https://leetcode.com/problems/word-ladder/", gfg: "https://www.geeksforgeeks.org/word-ladder-length-of-shortest-chain-to-reach-a-target-word/" },
                { name: "Number of Islands", difficulty: "Medium", leetcode: "https://leetcode.com/problems/number-of-islands/", gfg: "https://www.geeksforgeeks.org/find-number-of-islands/" }
            ]
        };

        // Initialize particles
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            const particleCount = 50;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.width = particle.style.height = (Math.random() * 3 + 2) + 'px';
                particle.style.animationDelay = Math.random() * 15 + 's';
                particle.style.animationDuration = (Math.random() * 20 + 15) + 's';
                particlesContainer.appendChild(particle);
            }
        }

        // Generate problems for each topic and store them globally
        function generateAllProblems() {
            allProblems = [];
            Object.entries(problemData).forEach(([topicName, problems]) => {
                problems.forEach((problem, index) => {
                    const problemId = `${topicName.toLowerCase().replace(/[^a-z0-9]/g, '-')}-${index}`;
                    allProblems.push({
                        id: problemId,
                        name: problem.name,
                        difficulty: problem.difficulty,
                        topic: topicName,
                        leetcode: problem.leetcode,
                        gfg: problem.gfg
                    });
                });
            });
        }

        // Create problem card HTML
        function createProblemCard(problem) {
            const isCompleted = problemStatus[problem.id] || false;
            const difficultyColors = {
                'Easy': 'from-green-500 to-emerald-500',
                'Medium': 'from-yellow-500 to-orange-500',
                'Hard': 'from-red-500 to-pink-500'
            };

            return `
                <div class="glass bg-white/10 dark:bg-gray-800/30 light:bg-white/90 backdrop-blur-lg rounded-2xl shadow-xl border border-white/20 dark:border-gray-700/50 light:border-gray-200 p-5 card-hover transition-all duration-300 ${isCompleted ? 'ring-2 ring-green-500/50' : ''}" 
                     data-problem-id="${problem.id}">
                    <div class="flex items-start justify-between mb-4">
                        <div class="flex items-start space-x-3 flex-1">
                            <button 
                                onclick="toggleProblem('${problem.id}')"
                                class="mt-1 w-5 h-5 rounded border-2 ${isCompleted ? 'bg-green-500 border-green-500' : 'border-gray-400 dark:border-gray-500 light:border-gray-400'} flex items-center justify-center transition-all duration-200 hover:scale-110 flex-shrink-0"
                            >
                                ${isCompleted ? '<i class="fas fa-check text-white text-xs"></i>' : ''}
                            </button>
                            <div class="flex-1 min-w-0">
                                <h4 class="text-sm font-medium text-gray-200 dark:text-gray-200 light:text-gray-900 mb-2 leading-relaxed">${problem.name}</h4>
                                <div class="flex flex-wrap gap-2">
                                    ${problem.leetcode ? `<a href="${problem.leetcode}" target="_blank" class="inline-flex items-center px-2 py-1 bg-gradient-to-r from-yellow-500 to-orange-500 text-white text-xs rounded-lg hover:from-yellow-600 hover:to-orange-600 transition-all duration-200 shadow-lg">
                                        <i class="fab fa-leetcode mr-1"></i>LeetCode
                                    </a>` : ''}
                                    ${problem.gfg ? `<a href="${problem.gfg}" target="_blank" class="inline-flex items-center px-2 py-1 bg-gradient-to-r from-green-500 to-emerald-500 text-white text-xs rounded-lg hover:from-green-600 hover:to-emerald-600 transition-all duration-200 shadow-lg">
                                        <i class="fas fa-code mr-1"></i>GFG
                                    </a>` : ''}
                                </div>
                            </div>
                        </div>
                        <span class="ml-3 px-2 py-1 bg-gradient-to-r ${difficultyColors[problem.difficulty]} text-white text-xs rounded-full font-medium shadow-lg flex-shrink-0">
                            ${problem.difficulty}
                        </span>
                    </div>
                </div>
            `;
        }

        // Create section HTML
        function createSection(topicName, problems) {
            const completedCount = problems.filter(p => problemStatus[p.id]).length;
            const totalCount = problems.length;
            const percentage = Math.round((completedCount / totalCount) * 100);
            
            const sectionId = topicName.toLowerCase().replace(/[^a-z0-9]/g, '-');
            
            return `
                <div class="glass bg-white/10 dark:bg-gray-800/30 light:bg-white/80 backdrop-blur-xl rounded-3xl shadow-2xl border border-white/20 dark:border-gray-700/50 light:border-gray-200 p-6 animate-slideInUp problem-section" data-topic="${sectionId}">
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
                        <div class="mb-4 md:mb-0">
                            <h2 class="text-2xl font-bold text-gray-100 dark:text-gray-100 light:text-gray-900 mb-2">${topicName}</h2>
                            <p class="text-gray-300 dark:text-gray-300 light:text-gray-700 text-sm">${problems.length} essential problems</p>
                        </div>
                        <div class="text-right">
                            <div class="text-sm text-gray-300 dark:text-gray-300 light:text-gray-700 mb-1">Progress</div>
                            <div class="text-2xl font-bold text-gray-100 dark:text-gray-100 light:text-gray-900">${completedCount}/${totalCount}</div>
                            <div class="text-sm text-purple-400 dark:text-purple-400 light:text-purple-600 font-medium">${percentage}%</div>
                        </div>
                    </div>
                    
                    <!-- Progress Bar -->
                    <div class="mb-6">
                        <div class="w-full bg-white/20 dark:bg-gray-700/50 light:bg-gray-200 rounded-full h-2 overflow-hidden">
                            <div 
                                class="bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 h-2 rounded-full transition-all duration-1000 ease-out"
                                style="width: ${percentage}%"
                            ></div>
                        </div>
                    </div>
                    
                    <!-- Problems Grid -->
                    <div class="space-y-4">
                        ${problems.map(problem => createProblemCard(problem)).join('')}
                    </div>
                </div>
            `;
        }

        // Toggle problem completion
        // Toggle problem completion
        async function toggleProblem(problemId) {
            problemStatus[problemId] = !problemStatus[problemId];
            
            // Firebase-only save - no localStorage
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            if (currentUser) {
                try {
                    await db.collection('userProblemStatus').doc(`${currentUser.email}_Collage`).set({
                        status: problemStatus,
                        lastUpdated: new Date().toISOString()
                    });
                    console.log('Collage problem status saved to Firebase');
                } catch (error) {
                    console.error('Error saving Collage problem status to Firebase:', error);
                }
            }
            
            // Add pulse animation
            const problemCard = document.querySelector(`[data-problem-id="${problemId}"]`);
            if (problemStatus[problemId]) {
                problemCard.classList.add('pulse-success');
                setTimeout(() => problemCard.classList.remove('pulse-success'), 1500);
            }
            
            renderProblems();
            updateStats();
            
            // Track user progress for admin
            updateUserProgress();
        }

        // Render all problems
        function renderProblems() {
            const container = document.getElementById('problemSections');
            const html = Object.entries(problemData).map(([topicName, problems]) => {
                const topicProblems = allProblems.filter(p => p.topic === topicName);
                return createSection(topicName, topicProblems);
            }).join('');
            
            container.innerHTML = html;
        }

        // Update statistics
        function updateStats() {
            const completed = allProblems.filter(p => problemStatus[p.id]).length;
            const total = allProblems.length;
            const percentage = Math.round((completed / total) * 100);
            
            document.getElementById('completedCount').textContent = completed;
            document.getElementById('totalCount').textContent = total;
            document.getElementById('progressPercentage').textContent = percentage + '%';
            document.getElementById('progressText').textContent = `${completed} / ${total}`;
            document.getElementById('progressBar').style.width = percentage + '%';
        }

        // Search functionality
        function setupSearch() {
            const searchInput = document.getElementById('searchInput');
            searchInput.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const sections = document.querySelectorAll('.problem-section');
                
                sections.forEach(section => {
                    const problemCards = section.querySelectorAll('[data-problem-id]');
                    let hasVisibleProblems = false;
                    
                    problemCards.forEach(card => {
                        const problemName = card.querySelector('h4').textContent.toLowerCase();
                        if (problemName.includes(searchTerm)) {
                            card.style.display = 'block';
                            hasVisibleProblems = true;
                        } else {
                            card.style.display = 'none';
                        }
                    });
                    
                    section.style.display = hasVisibleProblems || searchTerm === '' ? 'block' : 'none';
                });
            });
        }

        // Dark mode toggle
        function setupDarkMode() {
            const darkModeToggle = document.getElementById('darkModeToggle');
            const darkModeIcon = document.getElementById('darkModeIcon');
            const body = document.body;
            const html = document.documentElement;
            
            // Load saved dark mode preference
            const isDarkMode = localStorage.getItem('collegeDarkMode') !== 'false';
            
            function updateDarkMode(isDark) {
                if (isDark) {
                    html.classList.add('dark');
                    html.classList.remove('light');
                    body.classList.add('dark');
                    body.classList.remove('light');
                    darkModeIcon.className = 'fas fa-sun text-white dark:text-yellow-400 light:text-gray-600 text-lg';
                } else {
                    html.classList.remove('dark');
                    html.classList.add('light');
                    body.classList.remove('dark');
                    body.classList.add('light');
                    darkModeIcon.className = 'fas fa-moon text-white dark:text-yellow-400 light:text-gray-600 text-lg';
                }
                localStorage.setItem('collegeDarkMode', isDark);
            }
            
            // Apply saved preference
            updateDarkMode(isDarkMode);
            
            // Toggle on click
            darkModeToggle.addEventListener('click', () => {
                const currentlyDark = html.classList.contains('dark');
                updateDarkMode(!currentlyDark);
            });
        }

        // Save progress to Firebase
        // Update user progress tracking
        async function updateUserProgress() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            if (!currentUser) return;
            
            const completed = Object.values(problemStatus).filter(Boolean).length;
            const total = allProblems.length;
            const percentage = total > 0 ? Math.round((completed / total) * 100) : 0;
            
            // Firebase-only progress tracking
            const progressData = {
                name: currentUser.name,
                email: currentUser.email,
                sheets: {
                    'Collage': {
                        completed: completed,
                        total: total,
                        percentage: percentage,
                        lastUpdated: new Date().toISOString()
                    }
                }
            };
            
            // Save to Firebase for real-time admin access
            try {
                await db.collection('userProgress').doc(currentUser.email).set(progressData, { merge: true });
                console.log('Collage progress saved to Firebase successfully');
            } catch (error) {
                console.error('Error saving Collage progress to Firebase:', error);
            }
            }
        }

        // Initialize the application
        async function init() {
            createParticles();
            generateAllProblems();
            
            // Load problem status from Firebase first
            await loadProblemStatusFromFirebase();
            
            renderProblems();
            updateStats();
            setupSearch();
            setupDarkMode();
            
            // Initialize user progress tracking
            updateUserProgress();
        }

        // Run when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>